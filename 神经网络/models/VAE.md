# VAEï¼ˆVariational Autoencoderï¼‰

## 1. ä¸€å¥è¯
- æŠŠ AE çš„æ½œç©ºé—´æ”¹æˆæ¦‚ç‡æ¨¡å‹ï¼šå­¦ä¹  `q(z|x)` ä¸ `p(x|z)`ï¼Œé€šè¿‡æœ€å¤§åŒ– `ELBO` åšç”Ÿæˆä¸è¡¨å¾å­¦ä¹ ã€‚

## 2. æœ¬è´¨ï¼ˆæ¦‚ç‡åŒ–é™ç»´ + ç”Ÿæˆå»ºæ¨¡ï¼‰
- æŠŠé«˜ç»´æ•°æ® `x` çœ‹æˆç”±ä½ç»´æ½œå˜é‡ `z` ç”Ÿæˆï¼š`p(x)=âˆ« p(z)p(x|z)dz`ï¼ˆæ½œå˜é‡æ¨¡å‹çš„â€œé™ç»´â€è§†è§’ï¼‰ã€‚
- VAE çš„æ ¸å¿ƒæ˜¯åŒæ—¶å­¦ä¸¤æ¡è·¯ï¼š  
  1) ç”Ÿæˆè·¯ï¼ˆdecoderï¼‰ï¼š`p_Î¸(x|z)` èƒ½ä» `z` é‡‡æ ·ç”Ÿæˆ `x`  
  2) æ¨æ–­è·¯ï¼ˆencoderï¼‰ï¼š`q_Ï†(z|x)` è¿‘ä¼¼éš¾ç®—çš„çœŸå®åéªŒ `p(z|x)`ï¼ˆç”¨ ELBO æŠŠå®ƒä»¬ç»‘åœ¨ä¸€èµ·è®­ç»ƒï¼‰
- å¯¹ç…§ï¼šGMMï¼ˆéšç±»åˆ«ï¼‰ã€HMMï¼ˆéšçŠ¶æ€ï¼‰ã€å› å­åˆ†æï¼ˆå°‘æ•°å› å­ï¼‰ä¹Ÿéƒ½æ˜¯â€œéšå˜é‡è§£é‡Šè§‚æµ‹â€ï¼›VAE åªæ˜¯æŠŠç”Ÿæˆ/æ¨æ–­ç”¨ç¥ç»ç½‘ç»œå‚æ•°åŒ–äº†ã€‚å…¥å£ï¼š[modules/DimensionalityReduction.md](../modules/DimensionalityReduction.md)
- `z -> x` è¿™æ­¥åœ¨ä¸åŒè¯­å¢ƒçš„åå­—ï¼ˆdecoder mapping / pushforward / å‚æ•°åŒ–ï¼‰è§ï¼š[modules/LatentToDataMapping.md](../modules/LatentToDataMapping.md)

- è®­ç»ƒ vs ç”Ÿæˆçš„ä¸€å¥è¯ï¼šè®­ç»ƒæ—¶ç”¨â€œè·Ÿæ ·æœ¬ç»‘å®šâ€çš„åéªŒé‡‡æ · `z~q_Ï†(z|x)`ï¼ˆCVAE åˆ™æ˜¯ `z~q_Ï†(z|x,y)`ï¼‰åˆ†å¸ƒï¼ˆçš„é‡‡æ ·ï¼‰ æ¥æ•™ decoder å­¦ä¼šé‡æ„/è§£é‡Šæ•°æ®ï¼Œå½±å“æ•°æ®çš„é¢‘ç‡æ¥è¿›è¡Œè®­ç»ƒdecoderï¼ŒåŒæ—¶ç”¨ `KL(q||p)` æŠŠ `q` æ‹‰å‘ç”Ÿæˆæ—¶è¦ç”¨çš„å…ˆéªŒ `p(z)`ï¼ˆæˆ–æ¡ä»¶å…ˆéªŒ `p(z|x)`ï¼‰ï¼›ç”Ÿæˆæ—¶åªéœ€ä» `p(z)` / `p(z|x)` é‡‡æ · `z`ã€‚ 


-zç»™å®šï¼Œå¾—åˆ°P(x|z) (å¾ˆéš¾ç®—)
-

-`logpÎ¸â€‹(x)=L(x)+KL(qÏ•â€‹(zâˆ£x) âˆ¥ pÎ¸â€‹(zâˆ£x))`
- - pÎ¸â€‹(xâˆ£z)=N(x;Â Î¼Î¸â€‹(z),Â Ïƒ^2I) å…ˆéªŒå‡è®¾
- EqÏ•â€‹(zâˆ£x)â€‹[logpÎ¸â€‹(xâˆ£z)]âˆâˆ’EqÏ•â€‹(zâˆ£x)â€‹âˆ¥xâˆ’fÎ¸â€‹(z)âˆ¥^2 ---MSEæ¨å¯¼ï¼ˆæ­£æ¯”ï¼‰
- KLæ¨å¯¼
-`L(x) = E_q[log p(x|z)]-KL(q(z|x)||p(z))`


-------------------------------------------------------------

- å¦‚æœç›´æ¥q(z|x) --- p(z) : L(x) = E_q[log p(x|z)] logpÎ¸â€‹(x)=L(x)+KL(p(z)âˆ¥ pÎ¸â€‹(zâˆ£x))

-E_q[log p(x|z)] ç½‘ç»œä¸ä¾èµ–z ï¼špÎ¸â€‹(xâˆ£z)=pÎ¸â€‹(x) 
- é€€åŒ–ä¸ºE(x)

 -å¦‚æœå¼•å…¥å˜åˆ†æ€æƒ³  
 - `p(x)=âˆ« p(z)p(x|z)dz`
 - X-->å¾—åˆ°z  qx|z  --->p(x|z)  åˆ™ç›¸å…³
 - 


- E_q[log p(x|z)]  è®©ğ‘§è·Ÿğ‘¥å¼ºç›¸å…³â€”â€”æŠŠæ¦‚ç‡è´¨é‡æ”¾åˆ°é‚£äº›èƒ½è®©å½“å‰ğ‘¥é‡å»ºå¾—æœ€å¥½çš„ğ‘§ä¸Š
- ä¸èƒ½é€€åŒ–ä¸ºE(x)




## 3. å…³é”®å¯¹è±¡
- å…ˆéªŒï¼š`p(z)`ï¼ˆå¸¸ç”¨ `N(0,I)`ï¼‰
- ç¼–ç å™¨/æ¨æ–­ç½‘ç»œï¼š`q_Ï†(z|x)`
- è§£ç å™¨/ç”Ÿæˆç½‘ç»œï¼š`p_Î¸(x|z)`

## 4. è®­ç»ƒç›®æ ‡ï¼ˆELBOï¼‰
- å…¥å£ï¼š`modules/ELBO.md`
- å¸¸å†™æˆï¼šé‡æ„é¡¹ `E_q[log p(x|z)]` + æ­£åˆ™é¡¹ `-KL(q(z|x)||p(z))`

### 4.1 æ•°å­—çº§ä¾‹å­ï¼šä¸ºä»€ä¹ˆ KL ä¼šâ€œæ•´ç†æ½œç©ºé—´â€ï¼ˆä½†ä¸æ”¹å˜çœŸå®ç»“æ„ï¼‰
å‡è®¾ 1 ç»´æ½œå˜é‡ï¼ˆæ–¹ä¾¿ç®—ï¼‰ï¼Œencoder è¾“å‡ºä¸¤ç°‡åéªŒï¼š
- å¯¹ä¸€åŠæ•°æ®ï¼š`q(z|x)=N(Î¼=+10, Ïƒ=0.1)`
- å¯¹å¦ä¸€åŠæ•°æ®ï¼š`q(z|x)=N(Î¼=-10, Ïƒ=0.1)`

è¿™æ—¶é‡æ„å¯èƒ½å¾ˆå¥½ï¼ˆä¸¤ç±»è¢«åˆ†å¾—å¾ˆå¼€ï¼Œdecoder å¾ˆå®¹æ˜“åŒºåˆ†ï¼‰ï¼Œä½†ç”Ÿæˆä¼šå¾ˆå·®ï¼šç”Ÿæˆæ—¶ç”¨å…ˆéªŒ `p(z)=N(0,1)` é‡‡æ ·ï¼Œ`z` åŸºæœ¬è½åœ¨ `[-3,3]`ï¼Œå‡ ä¹æŠ½ä¸åˆ° `Â±10`ï¼›è€Œ decoder ä¸»è¦åœ¨ `Â±10` é™„è¿‘è¢«è®­ç»ƒè¿‡ã€‚

KL ä¼šå¼ºçƒˆæƒ©ç½šâ€œ`Î¼` å¤ªç¦»è°±â€ã€‚å¯¹é«˜æ–¯æœ‰é—­å¼ï¼š
- `KL(N(Î¼,Ïƒ^2) || N(0,1)) = 1/2 * (Î¼^2 + Ïƒ^2 - log Ïƒ^2 - 1)`
- å½“ `Î¼=10, Ïƒ=0.1` æ—¶ï¼Œ`Î¼^2/2=50` å·²ç»å¾ˆå¤§ï¼Œå› æ­¤ KL ä¼šé€¼ encoder æŠŠå‡å€¼å¾€ 0 æ‹‰ã€æˆ–è€…æŠŠæ–¹å·®å˜å¤§ã€æˆ–è€…ä¸¤è€…å…¼æœ‰ã€‚

ç»“æœæ˜¯ï¼š
- `z` ç©ºé—´é‡Œâ€œè¢«æ•°æ®å ç”¨çš„åŒºåŸŸâ€æ›´é è¿‘ 0ã€æ›´åƒé«˜æ–¯ï¼ˆæ›´å®¹æ˜“ä» `N(0,1)` é‡‡æ ·åˆ°â€œæœ‰æ•ˆ zâ€ï¼‰
- decoder ä¹Ÿè¢«è¿«å­¦ä¼šï¼šåœ¨è¿™å—æ›´â€œè§„æ•´â€çš„ `z` åŒºåŸŸé‡Œï¼Œä»èƒ½é‡æ„/ç”Ÿæˆ

æ³¨æ„ï¼šçœŸå®æ•°æ®çš„ç»“æ„ï¼ˆä½ åœ¨ `x` ç©ºé—´çœ‹åˆ°çš„ä¸¤ç°‡/ä¸€å¼ â€œæµå½¢â€ï¼‰æ²¡å˜ï¼›å˜çš„æ˜¯â€œä½ ç”¨ `z` æ€ä¹ˆç¼–ç å®ƒä»¬â€ä»¥åŠâ€œdecoder åœ¨ `z` ä¸Šæ€ä¹ˆé“ºå¼€ç”Ÿæˆâ€ã€‚

## 5. å…³é”®æµç¨‹ï¼ˆæ ¸å¿ƒæ•°æ®æµï¼‰
- è®­ç»ƒï¼š`x -> Encoder -> (mu, logvar) -> reparam -> z -> Decoder -> x_hat/x_logits -> (recon + KL) -> backprop æ›´æ–°å‚æ•°`
- ç”Ÿæˆï¼š`z ~ N(0, I) -> Decoder -> x_hat`

## 6. å…³é”®æŠ€å·§
- é‡å‚æ•°åŒ–ï¼š`modules/ReparameterizationTrick.md`

## 7. Tensor çº§ä¾‹å­ï¼ˆå›¾ç‰‡ HÃ—WÃ—3ï¼‰
- RGB å›¾ç‰‡çš„ shape å¯¹é½ä¸ loss è®¡ç®—ï¼š[VAE_TensorLevelExample.md](../examples/VAE_TensorLevelExample.md)

## 8. å¸¸è§å‘ & Debug
- Posterior collapseï¼ˆå°¤å…¶æ˜¯å¼ºè§£ç å™¨/æ–‡æœ¬ä»»åŠ¡ï¼‰
- KL æƒé‡/é€€ç«ï¼ˆKL annealingï¼‰ã€Î²-VAE ç­‰ç­–ç•¥

## 9. æ‰©å±•
- Î²-VAEã€IWAEã€VQ-VAEã€CVAEï¼ˆè§ `models/CVAE.md`ï¼‰
